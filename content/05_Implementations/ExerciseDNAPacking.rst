Вариант 1: Упаковка ДНК
-----------------------

Экcперименты FISH и Hi-C позволяют получить информацию о пространственной организации молекулы ДНК внутри хромосомы [Dekker02]_, [Lieberman-Aiden]_, [Fraser]_, [Nagano]_.
Суть эксперимента состоит в том, чтобы при помощи химической реакции скрепить соседние участки нити ДНК друг с другом (Рисунок 1a).
Затем геном расшепляется на :math:`N` небольших участков, при этом химическая сцепка не разрушается.
В результате получается раствор, содержащий :math:`N` небольших участков ДНК, некоторые из которых скреплены между собой.
Далее делается предположение, что вероятность того, что участки :math:`i` и :math:`j` окажутся скреплены зависит от того, насколько близко друг к другу они находились изначально.
То есть, если какие-то из участков находятся в хромосомах близко друг к другу, очень вероятно что они свяжутся.
Если же они находятся далеко, то вероятность связывания мала.
Посчитав количества пар :math:`i-j` в растворе, можно построить матрицу близости отдельных учатков ДНК в хромосоме (Рисунок 1b).
Используя эту матрицу, можно хатем восстановить исходную пространственную структуру ДНК (Рисунок 1c).


    .. figure:: img/HiC.png
  
        Рисунок 1:
        (a): Схема эксперимента Hi-C.
        Два соседних участка скрепляются ковалентной сшивкой, затем ДНК расщепляется специальным ферментом.
        Далее проводится анализ того, какие из участков ДНК скрепились между собой.
        (b): Участок получаемой в результате эксперимента матрицы близости участков ДНК.
        Индексы :math:`i` и `j` в матрице соответствуют номеру участка ДНК, а цвет --- близости участков :math:`i` и :math:`j` в хромосоме.
        Близость определяется из количества раз, в которых участки :math:`i` и :math:`j` были связаны между собой в эксперименте.
        (c): Интерпретация экспериментальных даннных на примере короткого участка молекулы ДНК.
        Иллюстрация взята из [Dekker02]_.

Результатом эксперимента Hi-C являются матрицы :math:`U` близости размером :math:`N\times N` , содержащие в качестве элемента :math:`U_{ij}` количества связываний для каждой пары участков ДНК :math:`i` и :math:`j`.
Примеры результатов реальных экспериментов можно скачать :download:`по этой ссылке <files/hicdata.tar.gz>`.
Каждой хромосоме соответствует отдельный файл.
Каждый файл содержит матрицу :math:`U_{ij}` размером :math:`N\times N` в текстовом формате (:math:`N` строк, по :math:`N` значений в каждой).

В работе предлагается реализовать программу, которая будет восстанавливать структуру ДНК по этим матрицам.
При этом ДНК представляется в виде набора из :math:`N` взаимодействующих центров с координатами :math:`{\mathbf{r}_i}`. Центры :math:`i` и :math:`i + 1` связываются ковалентно, при помощи гармонического потенциала:

    .. math::

        V_{cov}({\mathbf{r}_i})=\sum_{i=0}^{N-2}k_C(|\mathbf{r}_i-\mathbf{r}_{i+1}|-r_0)^2,

где :math:`k_c = 100` --- коэфициент упругости ковалентной связи, а :math:`r_0 = 0.1` --- равновесное расстояние.
Все пары фрагментов ДНК :math:`i` и :math:`j`, для которых элемент матрицы :math:`U_{ij}` не нулевой, также связываются при помощи гармонического потенциала:

    .. math::

        V_{hic}({\mathbf{r}_i})=\sum_{U_{ij}\ne 0}k_{ij}(|\mathbf{r}_i-\mathbf{r}_{i+1}|-r_{ij}^0)^2,

где

    .. math::

        \begin{split}
        k_{ij} &= 50.0 \times \frac{U_{ij}}{\max_{ij}\{U_{ij}\}},\\
        r^0_{ij} &= 0.19 + 0.01 \times \frac{\max_{ij} \{U_{ij}\}}{U_{ij}}.
        \end{split}

Далее, для каждой частицы численно интегрируются уравнения движения Ланжевена:

    .. math::

            m\frac{d^2\mathbf{r}_i}{dt^2}=-\nabla_iV-\lambda\frac{d\mathbf{r}_i}{dt}+\eta_i(t),

где :math:`m = 1.0` --- масса частиц, :math:`V({\mathbf{r}_i}) = V_{cov}({\mathbf{r}_i}) + V_{hic}({\mathbf{r}_i})` --- потенциальная энергия системы, :math:`\nabla_i V` --- градиент потенциала по координате :math:`i`-ой частицы. :math:`\eta_i(t)` --- случайная сила, описывающая соударения с молекулами воды с нормальным распределением:

    .. math::

            \langle\eta_i(t)\eta_j(t)\rangle = 2\lambda k_BT\delta_{ij}\delta(t-t')

Динамику Ланжевена можно рассматривать как динамику Ньютона с добавлением двух дополнительных сил: силы трения, пропорциональной скорости частицы и случайной силы, распределенной по Гауссу. Коэффициент пропорциональности :math:`\lambda` называется коэфициентом демпфирования и задает силу влияния среды на молекулу. При больших :math:`\lambda` система переходит к Брауновскому движению, при малых --- к Ньютоновскому.

Для численного решения уравнения Ланжевена можно использовать следующую разностную схему:

    .. math::

        \begin{split}
         m_i\frac{\mathbf{v}_{i}^{n+\frac{1}{2}}-\mathbf{v}_{i}^{n-\frac{1}{2}}}{\tau} &= \mathbf{f}_{i}^{n} - \lambda m_i\frac{\mathbf{v}_{i}^{n+\frac{1}{2}}+\mathbf{v}_{i}^{n-\frac{1}{2}}}{2}+\sqrt{\frac{2k_BT\lambda m_i}{\tau}}\mathbf{r}_i^f\\
        \frac{\mathbf{r}_{i}^{n+1}-\mathbf{r}_{i}^{n}}{\tau} &= \mathbf{v}_{i}^{n+\frac{1}{2}}

        \end{split}

Здесь, :math:`\lambda=50` --- коэфициент демпфирования, :math:`\mathbf{r}_i^f` --- вектор из трех нормально распределенных случайных величин, с дисперсией :math:`1` и математическим ожиданием :math:`0`. Постоянная Больцмана :math:`k_B=8.31\times10^{-3}` кДж/K*моль, шаг по времени :math:`\tau=0.001` пс, температура :math:`T=300` K.

В качестве начальной структуры можно взять линейную молекулу, в которой частицы разделены расстоянием в :math:`0.1` нм. Так как все частицы связаны, периодические граничные условия не требуются.

К заданию прилагается :download:`архив <files/hicdata.tar.gz>`, который содержит экспериментальные данные и небольшую программу, которая считывает данные из файла и распечатывает на экран все пары с ненулевыми значениями :math:`U_{ij}`.

Отображение структуры в программе VMD
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

При использовании файлов координат (например, xyz), VMD добавляет в отображения связи, основываясь на расстоянии между частицами.
Чтобы отобразить нить ДНК в виде цепочки связанных частиц, можно создать файл координат, где эти частицы будут находится вдоль одной прямой на расстоянии 1.0 Ангстрем друг от друга.
Эти координаты потом можно удалить из молекулы. 


    .. [Dekker02] J. Dekker, K. Rippe, M. Dekker, and N. Kleckner, “Capturing chromosome conformation,” Science, vol. 295, no. 5558, pp. 1306--1311, 2002.

    .. [Lieberman-Aiden] E. Lieberman-Aiden, N. L. Van Berkum, L. Williams, M. Imakaev, T. Ragoczy, A. Telling, I. Amit, B. R. Lajoie, P. J. Sabo, M. O. Dorschner, et al., “Comprehensive mapping of long-range interactions reveals folding principles of the human genome,” Science, vol. 326, no. 5950, pp. 289--293, 2009.

    .. [Fraser] J. Fraser, I. Williamson, W. A. Bickmore, and J. Dostie, “An overview of genome organization and how we got there: from FISH to Hi-C,” Microbiol. Mol. Biol. Rev., vol. 79, no. 3, pp. 347--372, 2015.

    .. [Nagano] T. Nagano, Y. Lubling, T. J. Stevens, S. Schoenfelder, E. Yaffe, W. Dean, E. D. Laue, A. Tanay, and P. Fraser, “Single-cell Hi-C reveals cell-to-cell variability in chromosome structure,” Nature, vol. 502, no. 7469, pp. 59--64, 2013.

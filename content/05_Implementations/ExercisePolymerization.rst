Вариант 2: Реакция полимеризации
--------------------------------

Простейшая реакция катализа записывается в виде: :math:`A+B\xrightarrow{k}A+C`. Динамику концентрации вещества :math:`A` и :math:`B` при этом можно описать при помощи следующей системы дифференциальных уравнений:

    .. math::

        \begin{cases}
        \frac{dB}{dt} = -kAB,\\
        \frac{dC}{dt} = kAB.
        \end{cases}

В Системе уравнений, :math:`A=\frac{N_{A}}{V_{0}}`, :math:`B=\frac{N_{B}}{V_{0}}`, :math:`C=\frac{N_{C}}{V_{0}}`, :math:`k` --- кинетическая константа скорости реакции, :math:`N_{A}`, :math:`N_{B}`, :math:`N_{C}` --- количество реагентов типа :math:`A`, :math:`B` и :math:`C` соответственно, :math:`V_{0}` --- объем системы. Решение системы:

    .. math::
        
        \begin{cases}
        B = B_{0}e^{-kAt},\\
        C = B_{0}-B=B_{0}(1-e^{-kAt}).
        \end{cases}

Реагирующая система может быть описана в виде конечного объема со случайным начальным распределением :math:`N` частиц в нем и заданными периодическими граничными условиями. Будем считать, что реакция происходит с некоторой вероятностью :math:`p=0.001` когда частицы :math:`A` и :math:`B` находятся ближе чем :math:`r_c=4.0` друг к другу. Взаимодействие частиц можно описать при помощи следущего потенциала:

    .. math::

        V(\vec{r}_i,\vec{r}_j)=\varepsilon\left[A\left(\frac{\sigma}{r_{ij}}\right)^{4} + B\left(\frac{\sigma}{r_{ij}}\right)^2\right],

где :math:`\varepsilon=1` --- энергетическая постоянная, :math:`\sigma=1` --- равновесное расстояние между частицами, :math:`A` и :math:`B` --- константы, :math:`r_{ij}=|\mathbf{r}_i-\mathbf{r}_j|` --- текущее расстояние между частицами.  Если задать постоянные :math:`A=1`, :math:`B=-2`, то взаимодействие между частицами будет притягивающим, а при :math:`A=0`, :math:`B=1` --- отталкивающим. Допустим, что продукт реакции :math:`C` полимеризуется. Тогда результатом реакции будет полимер, состоящий из молекул типа :math:`C`. Для описания процесса полимеризации предлагается использовать потенциал c притягивающими постоянными (:math:`A=1` и :math:`B=-2`) в случае, если обе частицы имеют тип :math:`C` и отталкивающие (:math:`A=0`, :math:`B=1`) в другом случае.

Движение частиц описывается уравнениями Ланжевена:

    .. math::

            m\frac{d^2\mathbf{r}_i}{dt^2}=-\nabla_iV-\lambda\frac{d\mathbf{r}_i}{dt}+\eta_i(t),

где :math:`m = 1.0` --- масса частиц, :math:`V({\mathbf{r}_i}) = V_{cov}({\mathbf{r}_i}) + V_{hic}({\mathbf{r}_i})` --- потенциальная энергия системы, :math:`\nabla_i V` --- градиент потенциала по координате :math:`i`-ой частицы. :math:`\eta_i(t)` --- случайная сила, описывающая соударения с молекулами воды с нормальным распределением:

    .. math::

            \langle\eta_i(t)\eta_j(t) = 2\lambda k_BT\delta_{ij}\delta(t-t')\rangle

Динамику Ланжевена можно рассматривать как динамику Ньютона с добавлением двух дополнительных сил: силы трения, пропорциональной скорости частицы и случайной силы, распределенной по Гауссу. Коэффициент пропорциональности :math:`\lambda` называется коэфициентом демпфирования и задает силу влияния среды на молекулу. При больших :math:`\lambda` система переходит к Брауновскому движению, при малых --- к Ньютоновскому.

Для численного решения уравнения Ланжевена можно использовать следующую разностную схему:

    .. math::

        \begin{split}
         m_i\frac{\mathbf{v}_{i}^{n+\frac{1}{2}}-\mathbf{v}_{i}^{n-\frac{1}{2}}}{\tau} &= \mathbf{f}_{i}^{n} - \lambda m_i\frac{\mathbf{v}_{i}^{n+\frac{1}{2}}+\mathbf{v}_{i}^{n-\frac{1}{2}}}{2}+\sqrt{\frac{2k_BT\lambda m_i}{\tau}}\mathbf{r}_i^f\\
        \frac{\mathbf{r}_{i}^{n+1}-\mathbf{r}_{i}^{n}}{\tau} &= \mathbf{v}_{i}^{n+\frac{1}{2}}

        \end{split}

Здесь, :math:`\lambda=50` --- коэфициент демпфирования, :math:`\mathbf{r}_i^f` --- вектор из трех нормально распределенных случайных величин, с дисперсией :math:`1` и математическим ожиданием :math:`0`. Постоянная Больцмана :math:`k_B=8.31\times10^{-3}` кДж/K*моль, шаг по времени :math:`\tau=0.001` пс, температура :math:`T=300` K.

Отображение структуры в программе VMD
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

VMD не умеет менять тип молекул.
Чтобы при визуализации системы цвет атомов менялся при реакции, можно использовать следующий способ.
Частицы :math:`B` и :math:`C` всегда сохраняются в файл координат в максимально возможном их количестве.
Например, если в начале симуляции в системе 100 частиц :math:`B` и 0 частиц :math:`C`, в файле координат сохраняется 100 частиц :math:`B` и 100 частиц :math:`C`.
При этом для неактивных частиц задаются координаты (0,0,0).
В ходе реакции, частицы :math:`B` становятся неактивными, а частицы :math:`C` --- наоборот переходят из неактивных в активные.
Координаты же переносятся от прореагирующей частицы к продукту реакции.
Таким образом, если отображать только активные частицы, при реакции прореагирующие частицы будут менять тип.

Для визуализации, в строке ``Selected atoms`` нужно написать ``not x = 0``, а во вкладке ``Trajectory`` выбрать пункт ``Update Selection Every Frame``.
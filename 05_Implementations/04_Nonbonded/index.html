<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Non-bonded interactions &mdash; MD simulations  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx_lesson.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/term_role_formatting.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx_rtd_theme_ext_color_contrast.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="PME" href="../05_PME/" />
    <link rel="prev" title="Bonded interactions" href="../03_Bonded/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../" class="icon icon-home">
            MD simulations
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Prerequisites</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../00_Prereq/01_Software/">Software</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Biological molecules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../02_BiologicalMolecules/01_Water/">Water molecule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_BiologicalMolecules/02_AminoAcids/">AminoAcids</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_BiologicalMolecules/03_Proteins/">Proteins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_BiologicalMolecules/04_DNA/">DNA and RNA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_BiologicalMolecules/05_MolecularSystems/">Molecular systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MD simulations of protein</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../03_UsingGROMACS/Calmodulin/Instructions/">MD simulations of calmodulin</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MD simulations of small molecules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../04_SmallMolecules/01_Benzene/">Create topology and coordinates for benzene molecule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_SmallMolecules/02_Alkanes/">Linear hydrocarbons (alkanes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_SmallMolecules/03_ManyMoleculesInABox/">GROMACS simulations of a box of 1000 octane molecules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Implementations</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_Integration/">Numerical integration of equations of motion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_GeneralNotesOnPotential/">From potential energy to atomic forces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Bonded/">Bonded interactions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Non-bonded interactions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#van-der-waals-forces-and-lennard-jones-potential">Van der Waals forces and Lennard-Jones potential</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#neighbors-or-verlet-lists">Neighbors or Verlet lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shift-function">Shift function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#switching-function">Switching function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../05_PME/">PME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_Constraints/">Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10_NaCl/">Implementation of a simple molecular dynamics code: NaCl in vacuum</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ExerciseDNAPacking/">Вариант 1: Упаковка ДНК</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ExercisePolymerization/">Вариант 2: Реакция полимеризации</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quick-reference/">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/">Instructor’s guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../AnglePotential/">Three-body potential</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">MD simulations</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Non-bonded interactions</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/zhmurov/content/blob/main/content/05_Implementations/04_Nonbonded.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="non-bonded-interactions">
<h1>Non-bonded interactions<a class="headerlink" href="#non-bonded-interactions" title="Permalink to this heading"></a></h1>
<blockquote>
<div><div class="math notranslate nohighlight">
\[V_{nb} = \sum_{i,j}\left(\frac{q_{i}q_{j}}{4\pi\varepsilon_{0}\varepsilon r_{ij}} +
         \varepsilon_{ij}\left[\left(\frac{\sigma_{ij}}{r_{ij}}\right)^{12}-2\left(\frac{\sigma_{ij}}{r_{ij}}\right)^{6}\right]\right)\]</div>
</div></blockquote>
<section id="van-der-waals-forces-and-lennard-jones-potential">
<h2>Van der Waals forces and Lennard-Jones potential<a class="headerlink" href="#van-der-waals-forces-and-lennard-jones-potential" title="Permalink to this heading"></a></h2>
<p>The van der Waals forces describe a combination of strong repulsion of short distances die to Pauli exclusion principle and weak attractive forces on larger distances due to dipole inducing (London dispersion forces). In computational chemistry it is usually described by the Lennard-Jones potential with the following expression:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[V_{nb} = \sum_{i,j}\varepsilon_{ij}\left[\left(\frac{\sigma_{ij}}{r_{ij}}\right)^{12}-2\left(\frac{\sigma_{ij}}{r_{ij}}\right)^{6}\right]\]</div>
</div></blockquote>
<section id="neighbors-or-verlet-lists">
<h3>Neighbors or Verlet lists<a class="headerlink" href="#neighbors-or-verlet-lists" title="Permalink to this heading"></a></h3>
<p>The computational complexity of evaluating forces when each particle is interacting with each other is <span class="math notranslate nohighlight">\(\approx N^2\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> is the total number of particles. Various techniques are used to improve the computational performance. One of the most common and most straightforward approach is neighbors or Verlet lists.</p>
<p>The potential vanishes as the distance between particles increase. This allows us to assume that after a certain distance, potential is zero. Hence, the forces for those atoms that are far away can be ignored. We can also assume that during a certain amount of steps atom don’t move much. Under this assumption we can construct a list of pairs of particles that are within certain distance <span class="math notranslate nohighlight">\(r_{lc}\)</span> at the time. Than, assuming that the potential is small enough to be ignored starting from a distance <span class="math notranslate nohighlight">\(r_{off}\)</span>, we can estimated the frequency of updating the list in number of steps, <span class="math notranslate nohighlight">\(s_{lc}\)</span>. This number should be small enough so that no particles are traveling father than a difference between <span class="math notranslate nohighlight">\(r_{lc}\)</span> and <span class="math notranslate nohighlight">\(r_{off}\)</span>, so that the particles that are outside the list cutoff distance <span class="math notranslate nohighlight">\(r_{lc}\)</span> at step <span class="math notranslate nohighlight">\(s\)</span> will not travel into the potential cutoff <span class="math notranslate nohighlight">\(r_{off}\)</span> at step <span class="math notranslate nohighlight">\(s+s_{lc}\)</span>. In some MD software the distances traveled by all particles since the last list update is computed. When the maximum of these distances become larger than the difference <span class="math notranslate nohighlight">\(r_{lc}-r_{off}\)</span>, the list update is triggered. Some software packages require user to define the update frequencies or compute <span class="math notranslate nohighlight">\(r_{lc}\)</span> and <span class="math notranslate nohighlight">\(s_{lc}\)</span> from the performance considerations. Note that values of <span class="math notranslate nohighlight">\(r_{lc}\)</span> and <span class="math notranslate nohighlight">\(s_{lc}\)</span> do not affect the result, only the performance. Larger the <span class="math notranslate nohighlight">\(r_{lc}\)</span>, less frequently the list should be updated (larger the <span class="math notranslate nohighlight">\(s_{lc}\)</span>) and vice-versa.</p>
<p>One important note is that the Lennard-Jones potential asymptotically goes to zero, but never zero. So if we set the potential to zero at a certain length, there will be step (albeit very small step) in the function at this distance. To avoid this step, the function should be smoothed out so it gradually goes to zero before <span class="math notranslate nohighlight">\(r_{off}\)</span>. Historically two different approaches to do so are used in MD simulations: shift function and switch function.</p>
</section>
<section id="shift-function">
<h3>Shift function<a class="headerlink" href="#shift-function" title="Permalink to this heading"></a></h3>
<p>the list is updated after <span class="math notranslate nohighlight">\(S_{lc}\)</span> number of steps, we can define a constant</p>
<blockquote>
<div><figure class="align-default" id="fig-nonbonded-verletlistsandswitchfunction">
<img alt="../../_images/VerletListsAndSwitchFunction.png" src="../../_images/VerletListsAndSwitchFunction.png" />
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Verlet or neighboring lists.</span><a class="headerlink" href="#fig-nonbonded-verletlistsandswitchfunction" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
<section id="switching-function">
<h3>Switching function<a class="headerlink" href="#switching-function" title="Permalink to this heading"></a></h3>
<p>Consider an arbitraty binary potential <span class="math notranslate nohighlight">\(V({\bf r})\)</span> (<span class="math notranslate nohighlight">\({\bf r}=(\vec{r}_{1},\vec{r}_{2},\ldots,\vec{r}_{N})\)</span>) that is subjected to a swithing function <span class="math notranslate nohighlight">\(sw({\bf r})\)</span>:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[V^{sw}({\bf r})=V({\bf r})sw({\bf r})=\sum_{i=1}^{N}\sum_{j=1}^{N}V_{ij}(r_{ij})sw_{ij}(r_{ij})\]</div>
</div></blockquote>
<p>According to the chain rule, the atomic force acting on <span class="math notranslate nohighlight">\(l\)</span>-th particle due to this potential will then be:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\begin{split}\begin{split}
    \vec{f}_{l}({\bf r})&amp;=-\nabla_{l} V^{sw}=-\nabla_{l}\left(\sum_{i=01}^{N}\sum_{j=1}^{N}V_{ij}(r_{ij})sw_{ij}(r_{ij})\right)=\\
    &amp;=-\sum_{i=1}^{N}\sum_{j=1}^{N}\left(\nabla_{l}V_{ij}(r_{ij})\right)sw_{ij}(r_{ij})+V_{ij}(r_{ij})\left(\nabla_{l}sw_{ij}(r_{ij})\right)
\end{split}\end{split}\]</div>
</div></blockquote>
<p>The actual form of the switching function <span class="math notranslate nohighlight">\(sw(r)\)</span> is given by <span id="id1">[]</span>:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\]</div>
<p>sw_{ij}(r_{ij})=
begin{cases}</p>
<blockquote>
<div><dl class="simple">
<dt>1 &amp; text{when } r_{ij}leq r_{on}\</dt><dd><p>frac{left(r_{off}^{2}-r_{ij}^{2}right)^{2}left(r_{off}^{2}+2r_{ij}^{2}-3r_{on}^{2}right)}{left(r_{off}^{2}-r_{on}^{2}right)^{3}} &amp; text{when } r_{on}&lt;r_{ij}leq r_{off}\
0 &amp; text{when } r_{ij}&gt;r_{off}\</p>
</dd>
</dl>
</div></blockquote>
<p>end{cases}</p>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(r_{on}\)</span> and <span class="math notranslate nohighlight">\(r_{off}\)</span> are switching and cut-off distances respectively.</p>
<p>Since cases when <span class="math notranslate nohighlight">\(r_{ij}\leq r_{on}\)</span> and when <span class="math notranslate nohighlight">\(r_{ij}&gt;r_{off}\)</span> are trivial, let us consider conditions when <span class="math notranslate nohighlight">\(r_{on}&lt;r_{ij}\leq r_{off}\)</span>.</p>
<p>According to the chain rule, one need to evaluate <span class="math notranslate nohighlight">\(V_{ij}(r_{ij})\)</span>, <span class="math notranslate nohighlight">\(\nabla_{l}V_{ij}(r_{ij})\)</span>, <span class="math notranslate nohighlight">\(sw_{ij}(r_{ij})\)</span> and <span class="math notranslate nohighlight">\(\nabla_{l}sw_{ij}(r_{ij})\)</span>. Since all four quantities can be computed independently, here we will only consider evaluation of <span class="math notranslate nohighlight">\(sw_{ij}(r_{ij})\)</span> and <span class="math notranslate nohighlight">\(\nabla_{l}sw_{ij}(r_{ij})\)</span>. Rearranging Eq.~ref{eq:sw} ($r_{on}&lt;r_{ij}leq r_{off}$), we get:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\]</div>
<p>sw_{ij}(r_{ij})= frac{2}{{left(r_{off}^{2}-r_{on}^{2}right)^{3}}}left(r_{off}^{2}-r_{ij}^{2}right)^{2}left(frac{r_{off}^{2}-3r_{on}^{2}}{2}+r_{ij}^{2}right)</p>
</div></blockquote>
<p>Since <span class="math notranslate nohighlight">\(r_{on}\)</span> and <span class="math notranslate nohighlight">\(r_{off}\)</span> are constant, one can use pre-computed values for:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\]</div>
<p>C^{sw}_{1} = frac{2}{left(r_{off}^{2}-r_{on}^{2}right)^{3}} text{,  }
C^{sw}_{2} = r_{off}^{2} text{, and  }
C^{sw}_{3} = frac{r_{off}^{2}-3r_{on}^{2}}{2}</p>
</div></blockquote>
<p>When $r_{on}&lt;r_{ij}leq r_{off}$ becomes:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\]</div>
<p>sw_{ij}(r_{ij})=C^{sw}_{1}left(C^{sw}_{2}-r_{ij}^{2}right)^{2}left(C^{sw}_{3}+r_{ij}^{2}right)</p>
</div></blockquote>
<p>Using Eq.~ref{eq:sw} ($r_{on}&lt;r_{ij}leq r_{off}$), we also can compute $nabla_{l}sw_{ij}(r_{ij})$:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\]</div>
<p>begin{split}
&amp;nabla_{l}sw_{ij}(r_{ij}) = frac{1}{left(r_{off}^{2}-r_{on}^{2}right)^{3}}left[2left(r_{off}^{2}-r_{ij}^{2}right)left(-2r_{ij}right)left(r_{off}^{2}+2r_{ij}^{2}-3r_{on}^{2}right)+left(r_{off}^{2}-r_{ij}^2right)^{2}4r_{ij}right]frac{vec{r}_{ij}}{r_{ij}} = \
&amp;= frac{1}{left(r_{off}^{2}-r_{on}^{2}right)^{3}}left[-4r_{off}^{4}-8r_{off}^{2}r_{ij}^{2}+12r_{off}^{2}r_{on}^{2}+4r_{ij}^{2}r_{off}^{2}+8r_{ij}^{4}-12r_{ij}^{2}r_{on}^{2}+4r_{off}^{4}-8r_{off}^{2}r_{ij}^{2}+4r_{ij}^{4}right]vec{r}_{ij} = \
&amp;= frac{1}{left(r_{off}^{2}-r_{on}^{2}right)^{3}}left[12r_{ij}^{4}-12r_{ij}^{2}r_{off}^{2}-12r_{ij}^{2}r_{on}^{2}+12r_{off}^{2}r_{on}^{2}right]vec{r}_{ij} = \
&amp;= frac{12}{left(r_{off}^{2}-r_{on}^{2}right)^{3}}left(r_{ij}^{2}-r_{off}^{2}right)left(r_{ij}^2-r_{on}^{2}right)vec{r}_{ij}\</p>
</div></blockquote>
<p>Using pre-computed values for:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\]</div>
<p>C^{dsw} = frac{12}{left(r_{off}^{2}-r_{on}^{2}right)^{3}}text{,  } r_{off}^{2} text{, and  } r_{on}^{2}</p>
</div></blockquote>
<p>Equation above becomes:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\]</div>
<p>nabla_{l}sw_{ij}(r_{ij})=C^{dsw}left(r_{ij}^{2}-r_{off}^{2}right)left(r_{ij}^2-r_{on}^{2}right)vec{r}_{ij}</p>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../03_Bonded/" class="btn btn-neutral float-left" title="Bonded interactions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../05_PME/" class="btn btn-neutral float-right" title="PME" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Artem Zhmurov.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>